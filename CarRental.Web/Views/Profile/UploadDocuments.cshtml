@model CarRental.Web.ViewModels.Profile.DocumentUploadViewModel
@{
    ViewData["Title"] = "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤";
    Layout = "_Layout";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-md-3">
            <partial name="_ProfileNavigation" />
        </div>
        <div class="col-md-9">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0">üì§ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h2>
                </div>
                <div class="card-body">
                    <div class="alert alert-warning">
                        <h6>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</h6>
                        <p class="mb-0">–ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É. –í—ã –Ω–µ —Å–º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>
                    </div>

                    <form method="post" asp-action="UploadDocuments" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()
                        
                        @if (!ViewData.ModelState.IsValid)
                        {
                            <div class="alert alert-danger">
                                <ul class="mb-0">
                                    @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                                    {
                                        <li>@error.ErrorMessage</li>
                                    }
                                </ul>
                            </div>
                        }

                        <h5 class="mb-3">üöó –í–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ</h5>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="DriverLicenseNumber" class="form-label fw-bold">–ù–æ–º–µ—Ä –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è *</label>
                                    <input type="text" id="DriverLicenseNumber" name="DriverLicenseNumber" 
                                           class="form-control" value="@Model.DriverLicenseNumber" required />
                                    <span asp-validation-for="DriverLicenseNumber" class="text-danger small"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="DriverLicenseExpiry" class="form-label fw-bold">–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è *</label>
                                    <input type="date" id="DriverLicenseExpiry" name="DriverLicenseExpiry" 
                                           class="form-control" value="@Model.DriverLicenseExpiry?.ToString("yyyy-MM-dd")" required />
                                    <span asp-validation-for="DriverLicenseExpiry" class="text-danger small"></span>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="DriverLicenseScan" class="form-label fw-bold">–°–∫–∞–Ω –≤–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏—è</label>
                            <input type="file" id="DriverLicenseScan" name="DriverLicenseScan" 
                                   class="form-control" accept=".jpg,.jpeg,.png,.pdf" />
                            <div class="form-text">–§–æ—Ä–º–∞—Ç: JPG, PNG, PDF. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB</div>
                        </div>

                        <h5 class="mb-3 mt-4">üÜî –ü–∞—Å–ø–æ—Ä—Ç</h5>

                        <div class="mb-3">
                            <label for="PassportScan" class="form-label fw-bold">–°–∫–∞–Ω –ø–∞—Å–ø–æ—Ä—Ç–∞ (—Ä–∞–∑–≤–æ—Ä–æ—Ç —Å —Ñ–æ—Ç–æ)</label>
                            <input type="file" id="PassportScan" name="PassportScan" 
                                   class="form-control" accept=".jpg,.jpeg,.png,.pdf" />
                            <div class="form-text">–§–æ—Ä–º–∞—Ç: JPG, PNG, PDF. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB</div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="@Url.Action("Documents", "Profile")" class="btn btn-secondary me-md-2">–û—Ç–º–µ–Ω–∞</a>
                            <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    
    <script>
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç—ã (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º)
        document.getElementById('DriverLicenseExpiry')?.addEventListener('change', function() {
            const selectedDate = new Date(this.value);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (selectedDate <= today) {
                this.setCustomValidity('–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º');
            } else {
                this.setCustomValidity('');
            }
        });

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
        document.querySelectorAll('input[type="file"]').forEach(input => {
            input.addEventListener('change', function() {
                const file = this.files[0];
                if (file && file.size > 5 * 1024 * 1024) { // 5MB
                    this.setCustomValidity('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5MB');
                } else {
                    this.setCustomValidity('');
                }
            });
        });
    </script>
}